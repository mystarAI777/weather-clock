<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>時間・分・天気画像の表示</title>
<style>
  html, body {
    margin: 0; padding: 0;
    width: 240px;
    height: 240px;
    background: #000000;
    font-family: 'Segoe UI', sans-serif;
    overflow: hidden;
    color: white;
  }
  #container {
    position: relative;
    width: 220px;
    height: 220px;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #weather-img {
    position: absolute;
    top: 0px; /* 位置を調整 */
    left: 0px; /* 右端に配置 */
    width: 110px;
    height: 110px;
    opacity: 1.0;
    z-index: 3;
    border-radius: 5px; /* 角を丸く */
  }
  #hours {
    position: absolute;
    top: 5px; /* 上の位置を微調整 */
    left: 0; /* 左端にぴったり */
    font-size: 150px;
    font-weight: bold;
    color: #00ff00; /* 時間の色 */
    user-select: none;
    margin: 0;
    padding: 0;
    text-shadow:
      -2px -2px 0 #000,
      2px -2px 0 #000,
      -2px 2px 0 #000,
      2px 2px 0 #000;
    z-index: 2;
    line-height: 1; /* 余白を調整 */
  }
  #minutes {
    position: absolute;
    top: 75px; /* 時間の下で調整 */
    left: 90px; /* 時間の下で右に1文字分ずらす */
    font-size: 130px;
    font-weight: bold;
    color: #ffcc00; /* 分の色 */
    user-select: none;
    z-index: 1;
    line-height: 1; /* 余白を調整 */
  }
  #temperature {
    position: absolute;
    top: 10px; /* 天気画像の下に配置 */
    right: 0px; /* 天気画像と同じく右端に */
    font-size: 30px; /* 温度のフォントサイズ */
    font-weight: bold;
    color: #ffffff; /* 温度の色 */
    z-index: 3;
    text-shadow:
      -1px -1px 0 #000,
      1px -1px 0 #000,
      -1px 1px 0 #000,
      1px 1px 0 #000;
  }
  #loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 20px;
      color: #888;
      z-index: 3;
      display: none; /* 初期は非表示 */
  }
  #error-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 16px;
      color: red;
      z-index: 3;
      display: none; /* 初期は非表示 */
      text-align: center;
  }
</style>
</head>
<body>
  <div id="container">
    <img id="weather-img" src="" alt="天気" />
    <span id="hours">00</span>
    <span id="minutes">00</span>
    <span id="temperature">--°</span>
    <div id="loading">天気読み込み中...</div>
    <div id="error-message"></div>
  </div>
<script>
  // WeatherAPI.com の設定
  const API_KEY = 'e514019799c24273af395822251808'; // ここにあなたのWeatherAPI.com APIキーを貼り付けてください
  const LOCATION = 'Tokorozawa'; // 所沢を指定。緯度経度 ('35.79,139.46') も可能
  const LANG = 'ja';             // 言語: 'ja' (日本語)

  const weatherImg = document.getElementById('weather-img');
  const temperatureSpan = document.getElementById('temperature');
  const loadingDiv = document.getElementById('loading');
  const errorDiv = document.getElementById('error-message');

  // --- 時刻表示の更新 ---
  function updateHours() {
    const now = new Date();
    const h = String(now.getHours()).padStart(2, '0');
    document.getElementById('hours').textContent = h;
  }
  function updateMinutes() {
    const now = new Date();
    const m = String(now.getMinutes()).padStart(2, '0');
    document.getElementById('minutes').textContent = m;
  }
  setInterval(updateHours, 1000); // 1秒ごとに更新
  setInterval(updateMinutes, 1000); // 1秒ごとに更新
  updateHours(); // ページの読み込み時に一度実行
  updateMinutes(); // ページの読み込み時に一度実行

  // --- 天気情報の更新 ---
  async function updateWeather() {
    loadingDiv.style.display = 'block'; // ローディング表示
    errorDiv.style.display = 'none';    // エラーメッセージ非表示
    weatherImg.style.display = 'none';  // 画像を非表示
    temperatureSpan.style.display = 'none'; // 温度を非表示

    try {
      // WeatherAPI.com forecast.json エンドポイント
      // days=1 で今日の予報のみ取得
      const apiUrl = `https://api.weatherapi.com/v1/forecast.json?key=${API_KEY}&q=${LOCATION}&days=1&aqi=no&alerts=no&lang=${LANG}`;

      const response = await fetch(apiUrl);
      if (!response.ok) {
        // エラーレスポンスの詳細を解析
        const errorData = await response.json();
        throw new Error(`HTTP error! Status: ${response.status}. Message: ${errorData.error.message || 'Unknown error'}`);
      }
      const data = await response.json();
      console.log('天気データ (WeatherAPI.com):', data); // 取得したデータをコンソールで確認

      // 今日の天気データ (forecast.forecastday配列の最初の要素)
      const todayForecast = data.forecast.forecastday[0]; 
      
      if (todayForecast) {
        const iconUrl = todayForecast.day.condition.icon; // 日中のアイコンURL
        const maxTemp = Math.round(todayForecast.day.maxtemp_c);
        const minTemp = Math.round(todayForecast.day.mintemp_c);

        // 天気アイコンの更新
        weatherImg.src = `https:${iconUrl}`; // WeatherAPIのURLは 'https:' がない場合がある
        weatherImg.alt = todayForecast.day.condition.text;
        weatherImg.style.display = 'block'; // 画像を表示

        // 気温の更新 (最高気温/最低気温)
        temperatureSpan.textContent = `${maxTemp}° / ${minTemp}°`;
        temperatureSpan.style.display = 'block'; // 温度を表示
      } else {
        throw new Error('今日の天気データが見つかりませんでした。');
      }

      loadingDiv.style.display = 'none'; // ローディング非表示

    } catch (error) {
      console.error('天気データの取得中にエラーが発生しました:', error);
      errorDiv.textContent = `天気データを取得できませんでした: ${error.message}`;
      errorDiv.style.display = 'block'; // エラーメッセージ表示
      loadingDiv.style.display = 'none'; // ローディング非表示
    }
  }

  // ページが読み込まれたら天気データを取得
  document.addEventListener('DOMContentLoaded', updateWeather);

  // 1時間ごとに天気予報を更新 (APIのリクエスト制限に注意)
  setInterval(updateWeather, 3600 * 1000); // 1時間 = 3600秒 * 1000ミリ秒
</script>
</body>
</html>
